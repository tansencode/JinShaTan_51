C51 COMPILER V9.01   MAIN                                                                  06/17/2018 14:31:19 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: D:\Keil4\C51\BIN\C51.EXE main.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /*****************ZY08-CѭңءϡѰ*****************
   2          //=====================================================================//
   3                             ZY08-Cѭϡңۺϳʾ                         //
   4          //  Ҫѭ򡢺ϳңۺһͨ尴л
   5          ɫСұ߰S4лͻɫ ôߵİS1
   6          лʾ1ѭģʽһ°ʾ2Ǳģʽһ°
   7          ʾ3Ǻңسܶʼлģʽ
   8          //---------------------------------------------------------------------//
   9          
  10          *  ƽ̨ZY08-CѭңءϡѰ + Keil U4 + STC89C52
  11          *  ƣ5ZY08-Cѭϡңۺϳ
  12          *  ˾ƽ豸޹˾
  13          *  д˾зһ
  14          *  :ܳQQ:1018973181 
  15          *  :11.0592MHZ
  16          *  ۺ˵ѿԴֿ֧ͻԼ޸ĳṩҹ˾˵
  17          *  Ƶ̳̣СѧϰCϸƵ̳̣ͳһ
  18          ******************************************************************/  
  19          
  20          #include <reg52.h> //51Ƭصͷļ
  21          #include <intrins.h>
  22          sbit LeftLed=P2^0;                        //ǰָʾƶ˿
  23          sbit RightLed=P0^7;                       //ǰҲָʾƶ˿
  24          sbit FontLled=P1^7;
  25          
  26          sbit LeftIR=P3^5;                         //ǰ̽ͷ˿
  27          sbit RightIR=P3^6;                        //ǰҲ̽ͷ˿
  28          sbit FontIR=P3^7;                         //ǰǰ̽ͷ˿
  29          
  30          sbit M1A=P0^0;                            //A
  31          sbit M1B=P0^1;                            //B
  32          
  33          sbit M2A=P0^2;                            //ҲA
  34          sbit M2B=P0^3;                            //ҲB
  35          
  36          sbit B1=P0^4;                             //ʶʶ𴫸˿
  37          sbit SB1=P0^6;                            //˿
  38          sbit IRIN=P3^3;                                       //ն˿
  39          
  40          unsigned char code  LedShowData[]={0x03,0x9F,0x25,0x0D,0x99,  //ʾ
  41                                             0x49,0x41,0x1F,0x01,0x19};//0,1,2,3,4,5,6,7,8,9
  42          unsigned char code  RecvData[]={0x19,0x46,0x15,0x43,0x44,0x40,0x0D,0x0E,0x00,0x0F};
  43          unsigned char IRCOM[7];
  44          static unsigned int LedFlash;                         //Ƶʼ
  45          bit EnableLight=0;                                    //ָʾʹλ
  46          #define ShowPort P2                                   //ʾ˿
  47          unsigned char temp = 1;
  48          void tingzhi()
  49          {
  50   1         M1A=0;                                   //M1A˳ʼΪ0
  51   1         M1B=0;                                   //M1B˳ʼΪ0
  52   1         M2A=0;                                   //M2A˳ʼΪ0
  53   1         M2B=0;
  54   1      
  55   1      }
C51 COMPILER V9.01   MAIN                                                                  06/17/2018 14:31:19 PAGE 2   

  56          
  57          void qianjin()
  58          {
  59   1         M1A=1;                                   
  60   1         M1B=0;                                   
  61   1         M2A=1;                                   
  62   1         M2B=0;
  63   1      }
  64          
  65          void houtui()
  66          {
  67   1         M1A=0;                                   
  68   1         M1B=1;                                   
  69   1         M2A=0;                                   
  70   1         M2B=1;
  71   1      }
  72          
  73          void zuozhuan()
  74          {
  75   1         M1A=0;                                   
  76   1         M1B=1;                                   
  77   1         M2A=1;                                   
  78   1         M2B=0;
  79   1      }
  80          
  81          void youzhuan()
  82          {
  83   1         M1A=1;                                   
  84   1         M1B=0;                                   
  85   1         M2A=0;                                   
  86   1         M2B=1;
  87   1      }
  88          
  89          void Delay1ms(unsigned int i) 
  90          { 
  91   1      unsigned char j,k; 
  92   1      do{ 
  93   2        j = 10; 
  94   2        do{ 
  95   3         k = 50; 
  96   3         do{ 
  97   4          _nop_(); 
  98   4         }while(--k);     
  99   3        }while(--j); 
 100   2      }while(--i); 
 101   1      
 102   1      } 
 103          
 104          void delay_nus(unsigned int i)  //ʱ:i>=12 ,iСʱ12 us
 105          { 
 106   1        i=i/10;
 107   1        while(--i);
 108   1      }   
 109          void delay_nms(unsigned int n)  //ʱn ms
 110          { 
 111   1        n=n+1;
 112   1        while(--n)  
 113   1        delay_nus(900);         //ʱ 1ms,ͬʱв
 114   1        
 115   1      }  
 116          
 117          void delayms(unsigned char x)                         //0.14mSʱ
C51 COMPILER V9.01   MAIN                                                                  06/17/2018 14:31:19 PAGE 3   

 118          {
 119   1        unsigned char i;                                    //ʱ
 120   1        while(x--)                                          //ʱʱѭ
 121   1        {
 122   2          for (i = 0; i<13; i++) {}                         //14mSʱ
 123   2        }
 124   1      }
 125          
 126          void Delay()                                          //ʱӳ
 127          { 
 128   1        unsigned int DelayTime=30000;                       //ʱʱ
 129   1        while(DelayTime--);                                 //ʼʱѭ
 130   1        return;                                             //ӳ򷵻
 131   1      }
 132          void ControlCar(unsigned char ConType)    //ӳ
 133          {
 134   1       
 135   1        tingzhi();
 136   1       switch(ConType)                          //жû趨ʽ
 137   1       {
 138   2        case 1:  //ǰ                         //жûǷѡʽ1
 139   2        { 
 140   3          //tingzhi();                                                      //ǰ֮ǰ ֹͣһʱ  ֹ
             -ѹ ϵͳλ
 141   3              //Delay1ms(50);
 142   3              LeftLed = 0 ;
 143   3              qianjin();
 144   3          break;
 145   3        }
 146   2        case 2: //                          //жûǷѡʽ2
 147   2        { 
 148   3         // tingzhi();                                                              //֮ǰ ֹͣһʱ
             -  ֹѹ ϵͳλ
 149   3         // Delay1ms(50);
 150   3          LeftLed = 1 ;          
 151   3              houtui();                                //M2ת
 152   3          break;
 153   3        }
 154   2        case 3: //ת                          //жûǷѡʽ3
 155   2        { 
 156   3           //tingzhi();                                                                  //ת֮ǰ ֹͣһ
             -ʱ  ֹѹ ϵͳλ
 157   3              // Delay1ms(50); 
 158   3               zuozhuan();                               //M2ת
 159   3               break;
 160   3        }
 161   2        case 4: //ת                          //жûǷѡʽ4
 162   2        { 
 163   3         // tingzhi();                                                                  //ת֮ǰ ֹͣһ
             -ʱ  ֹѹ ϵͳλ
 164   3      //        Delay1ms(50);
 165   3              youzhuan();                                //M1ת
 166   3                                                //M2ת
 167   3              break;
 168   3        }
 169   2        case 8: //ֹͣ                          //жûǷѡʽ8
 170   2        {
 171   3          tingzhi();
 172   3              break;                                //˳ǰѡ
 173   3        }
 174   2       }
 175   1      }
C51 COMPILER V9.01   MAIN                                                                  06/17/2018 14:31:19 PAGE 4   

 176          
 177          void ControlCar_yaokong(unsigned char ConType)    //ӳ        (ңصһ switch
             -  case    )
 178          {
 179   1       
 180   1        tingzhi();
 181   1       switch(ConType)                          //жû趨ʽ
 182   1       {
 183   2        case 1:  //ǰ                         //жûǷѡʽ1
 184   2        { 
 185   3          tingzhi();                                                      //ǰ֮ǰ ֹͣһʱ  ֹ
             -ѹ ϵͳλ
 186   3              Delay1ms(150);
 187   3              LeftLed = 0 ;
 188   3              qianjin();
 189   3          break;
 190   3        }
 191   2        case 2: //                          //жûǷѡʽ2
 192   2        { 
 193   3          tingzhi();                                                              //֮ǰ ֹͣһʱ 
             - ֹѹ ϵͳλ
 194   3          Delay1ms(150);
 195   3          LeftLed = 1 ;          
 196   3              houtui();                                //M2ת
 197   3          break;
 198   3        }
 199   2        case 3: //ת                          //жûǷѡʽ3
 200   2        { 
 201   3           tingzhi();                                                                  //ת֮ǰ ֹͣһ
             -ʱ  ֹѹ ϵͳλ
 202   3               Delay1ms(150); 
 203   3               zuozhuan();                               //M2ת
 204   3               break;
 205   3        }
 206   2        case 4: //ת                          //жûǷѡʽ4
 207   2        { 
 208   3           tingzhi();                                                                  //ת֮ǰ ֹͣһ
             -ʱ  ֹѹ ϵͳλ
 209   3               Delay1ms(150);
 210   3           youzhuan();                                //M1ת  //M2ת
 211   3                break;
 212   3        }
 213   2        case 8: //ֹͣ                          //жûǷѡʽ8
 214   2        {
 215   3          tingzhi();
 216   3              break;                                //˳ǰѡ
 217   3        }
 218   2       }
 219   1      }
 220          void Robot_Avoidance()                   //˱ӳ
 221          {
 222   1      
 223   1         LeftLed=LeftIR;                        //ǰָʾָʾǰ̽ͷ״̬
 224   1         RightLed=RightIR;                      //ǰҲָʾָʾǰҲ̽ͷ״̬
 225   1         FontLled= FontIR; 
 226   1         SB1=FontIR;
 227   1      
 228   1          if(FontIR == 0)                          //ǰϴ⵽ϰ
 229   1         {
 230   2            ControlCar(8);                       //ֹͣ
 231   2            delay_nms (300);                                           //ֹͣ300MS   ֹѹ  
             -ͳλ
C51 COMPILER V9.01   MAIN                                                                  06/17/2018 14:31:19 PAGE 5   

 232   2                ControlCar(2);                                           //  
 233   2                delay_nms (1000);                                           //1500MS  
 234   2                ControlCar(3);                                           //
 235   2                delay_nms (1800);        
 236   2        }
 237   1         else
 238   1         {
 239   2            ControlCar(1);                      //Ҳûźʱ,ʼתһĽǶ
 240   2            delay_nms (10);
 241   2         }
 242   1          ControlCar(1);
 243   1      }
 244          //ѭӳ
 245          void Robot_Traction()                     //ѭӳ
 246          {
 247   1         LeftLed=LeftIR;                        //ǰָʾָʾǰ̽ͷ״̬
 248   1         RightLed=RightIR;                      //ǰҲָʾָʾǰҲ̽ͷ״̬
 249   1         FontLled= FontIR; 
 250   1         SB1=LeftIR;
 251   1         if(LeftIR == 0 && RightIR == 0)    //⵽ߣǰ
 252   1         {
 253   2            ControlCar(1);                      //ûźʱʼתһĽǶ
 254   2            delay_nms (10);
 255   2         }
 256   1         
 257   1         else if(LeftIR == 0 && RightIR == 1)
 258   1         {
 259   2            ControlCar(3);                      //Ҳûźʱ,ʼתһĽǶ
 260   2            delay_nms (10);
 261   2         }
 262   1      
 263   1         else if(LeftIR == 1 && RightIR == 0)
 264   1         {
 265   2            ControlCar(4);                      //Ҳûźʱ,ʼתһĽǶ
 266   2            delay_nms (10);
 267   2         }
 268   1          ControlCar(8);
 269   1      }
 270          
 271          void main()                               //
 272          {
 273   1        
 274   1        bit RunFlag=0;                          //Сб־λ
 275   1        LedFlash=3000;                                       //ݽгʼ
 276   1        //EX1=1;                                               //ͬ⿪ⲿж1
 277   1        IT1=1;                                               //趨ⲿж1ΪͱԵ
 278   1        EA=1;                                                //жϿ
 279   1        ControlCar(8);                          //ʼС״̬
 280   1        while(1)                                //ѭ
 281   1        {
 282   2                   if(P3^2 == 0)
 283   2                {
 284   3                 delay_nms(10);
 285   3                 if(P3^2 == 0)
 286   3                 {
 287   4                           temp++;
 288   4                        while(!P3^2);
 289   4                 }
 290   3                }
 291   2                if(temp > 3)
 292   2                {
 293   3                temp = 1;
C51 COMPILER V9.01   MAIN                                                                  06/17/2018 14:31:19 PAGE 6   

 294   3                }
 295   2                switch(temp)
 296   2                {
 297   3                         case 1:        ShowPort = LedShowData[1];Robot_Traction();EX1 = 0;break;
 298   3                      case 2: ShowPort = LedShowData[2];Robot_Avoidance();EX1 = 0;break;
 299   3                      case 3: ShowPort = LedShowData[3];EX1 = 1;break;
 300   3                }
 301   2        }
 302   1      }
 303          //----------ң-------------------------------------------------------------
 304          void IR_IN() interrupt 2 using 0                      //INT2ⲿжϺ
 305          {
 306   1        unsigned char j,k,N=0;                              //ʱձ
 307   1         
 308   1        EX1 = 0;                                            //رⲿж,ֹźŵ   
 309   1        delayms(15);                                        //ʱʱ䣬к
 310   1        if (IRIN==1)                                        //жϺźǷʧ
 311   1        {  
 312   2           EX1 =1;                                          //ⲿжϿ
 313   2               return;                                          //
 314   2        } 
 315   1                                 
 316   1        while (!IRIN)                                       //IRΪߵƽ9msǰ͵ƽźš
 317   1        {
 318   2            delayms(1);                                     //ʱȴ
 319   2        }
 320   1      
 321   1        for (j=0;j<4;j++)                                   //ɼң
 322   1        { 
 323   2          for (k=0;k<8;k++)                                 //ִβɼ8λ
 324   2          {
 325   3             while (IRIN)                                   // IR Ϊ͵ƽ4.5msǰߵƽźš
 326   3             {
 327   4               delayms(1);                                  //ʱȴ
 328   4             }
 329   3             
 330   3             while (!IRIN)                                  // IR Ϊߵƽ
 331   3             {
 332   4               delayms(1);                                  //ʱȴ
 333   4             }
 334   3         
 335   3             while (IRIN)                                   //IRߵƽʱ
 336   3             {
 337   4               delayms(1);                                  //ʱȴ
 338   4               N++;                                         //Ӽ
 339   4               if (N>=30)                                   //жϼۼֵ
 340   4                   { 
 341   5                 EX1=1;                                     //ⲿжϹ
 342   5                     return;                                    //
 343   5               }                   
 344   4             }
 345   3                                             
 346   3            IRCOM[j]=IRCOM[j] >> 1;                         //λƲԶ
 347   3           
 348   3            if (N>=8)                                       //жݳ 
 349   3            {
 350   4               IRCOM[j] = IRCOM[j] | 0x80;                  //λ1
 351   4            } 
 352   3            N=0;                                            //λ¼
 353   3          }
 354   2        }
 355   1         
C51 COMPILER V9.01   MAIN                                                                  06/17/2018 14:31:19 PAGE 7   

 356   1        if (IRCOM[2]!=~IRCOM[3])                            //жϵַǷͬ
 357   1        { 
 358   2           EX1=1;                                           //ⲿж
 359   2           return;                                          //
 360   2        }
 361   1      
 362   1        for(j=0;j<10;j++)                                   //ѭм
 363   1         {
 364   2            if(IRCOM[2]==RecvData[j])                       //мλӦ
 365   2            {
 366   3             // ControlCar(j);
 367   3                      ControlCar_yaokong(j);                               //ʾӦ
 368   3            }
 369   2         } 
 370   1         EX1 = 1;                                           //ⲿжϿ 
 371   1      } 
 372          //------------------------------------------------------------------------------------------------------- 


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    666    ----
   CONSTANT SIZE    =     20    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     10       2
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      1       1
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
